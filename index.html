<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personality Pairing Explorer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
        }
        .dropdown-container {
            margin-bottom: 20px;
        }
        select {
            margin-right: 10px;
            padding: 5px;
            font-size: 16px;
        }
        #output {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        h2 {
            margin-top: 0;
        }
        label {
            margin-right: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <h1>Personality Pairing Explorer</h1>
    <div class="dropdown-container">
        <label for="mode">Select Mode: </label>
        <select id="mode">
            <option value="dataset1">Mode 1 (Dataset 1)</option>
            <option value="dataset2">Mode 2 (Dataset 2)</option>
            <option value="dataset3">Mode 3 (Dataset 3)</option>
        </select>
    </div>

    <div class="dropdown-container">
        <h2>First Personality</h2>
        <select id="volume1">
            <option value="R">R (Reserved)</option>
            <option value="M">M (Measured)</option>
            <option value="O">O (Outgoing)</option>
        </select>
        <select id="focus1">
            <option value="P">P (Past)</option>
            <option value="N">N (Now)</option>
            <option value="F">F (Future)</option>
        </select>
        <select id="trait1">
            <option value="I">I (Independent)</option>
            <option value="M">M (Mutual)</option>
            <option value="D">D (Dependent)</option>
        </select>
    </div>

    <div class="dropdown-container">
        <h2>Second Personality</h2>
        <select id="volume2">
            <option value="R">R (Reserved)</option>
            <option value="M">M (Measured)</option>
            <option value="O">O (Outgoing)</option>
        </select>
        <select id="focus2">
            <option value="P">P (Past)</option>
            <option value="N">N (Now)</option>
            <option value="F">F (Future)</option>
        </select>
        <select id="trait2">
            <option value="I">I (Independent)</option>
            <option value="M">M (Mutual)</option>
            <option value="D">D (Dependent)</option>
        </select>
    </div>

    <div id="output">
        <h2>Results</h2>
        <p><strong>Pairing:</strong> <span id="pairing"></span></p>
        <p><strong>Description:</strong> <span id="description"></span></p>
        <p><strong>Cautions:</strong> <span id="cautions"></span></p>
        <p><strong>Advice/Recommendations:</strong> <span id="advice"></span></p>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script>
        let pairings = [];
        let currentMode = 'dataset1'; // Default mode

        async function loadPairings(mode) {
            try {
                const response = await fetch(`data/${mode}.csv`);
                const csvText = await response.text();
                Papa.parse(csvText, {
                    header: true,
                    complete: (result) => {
                        pairings = result.data;
                        updateOutput(); // Update after data is loaded
                    },
                    error: (error) => {
                        console.error('Error parsing CSV:', error);
                        document.getElementById("description").textContent = "Error loading pairing data.";
                    }
                });
            } catch (error) {
                console.error('Error loading pairings:', error);
                document.getElementById("description").textContent = "Error loading pairing data.";
            }
        }

        function getTraitDescription(volume, focus, trait) {
            const volumeMap = {
                'R': 'quiet',
                'M': 'balanced',
                'O': 'vocal'
            };
            const focusMap = {
                'P': 'reflective',
                'N': 'present-focused',
                'F': 'forward-thinking'
            };
            const traitMap = {
                'I': 'independent',
                'M': 'cooperative',
                'D': 'reliant'
            };
            return `${volumeMap[volume] || volume} ${focusMap[focus] || focus} ${traitMap[trait] || trait}`;
        }

        function generateDynamicPairing(p1, p2, forwardPairing) {
            const [v1, f1, t1] = p1.split('-');
            const [v2, f2, t2] = p2.split('-');

            const desc1 = getTraitDescription(v1, f1, t1);
            const desc2 = getTraitDescription(v2, f2, t2);

            const description = `${desc1} meets ${desc2}â€”${v1 === v2 ? 'similar' : 'contrasting'} styles in ${f1 === f2 ? 'aligned' : 'differing'} focus and ${t1 === t2 ? 'matched' : 'varied'} dependence.`;
            const cautions = `Potential for ${v1 === 'O' && v2 === 'R' ? 'overwhelm vs. withdrawal' : t1 === 'D' && t2 === 'I' ? 'reliance vs. independence clash' : 'misalignment'}; ${f1 !== f2 ? 'differing time focus may cause disconnect' : 'similar focus may stagnate'}.`;
            const advice = `First: ${v1 === 'R' ? 'open up slightly' : v1 === 'O' ? 'tone down intensity' : 'maintain balance'}. Second: ${t2 === 'D' ? 'express needs gently' : t2 === 'I' ? 'offer space' : 'seek mutual ground'}. ${f1 !== f2 ? 'Bridge time focus with shared activities.' : 'Explore shared goals.'}`;

            return {
                pairing: forwardPairing,
                description,
                cautions,
                advice
            };
        }

        function updateOutput() {
            const volume1 = document.getElementById("volume1").value;
            const focus1 = document.getElementById("focus1").value;
            const trait1 = document.getElementById("trait1").value;
            const volume2 = document.getElementById("volume2").value;
            const focus2 = document.getElementById("focus2").value;
            const trait2 = document.getElementById("trait2").value;

            const forwardPairing = `${volume1}-${focus1}-${trait1} x ${volume2}-${focus2}-${trait2}`;
            const reversePairing = `${volume2}-${focus2}-${trait2} x ${volume1}-${focus1}-${trait1}`;

            let match = pairings.find(p => p.pairing === forwardPairing || p.pairing === reversePairing);

            if (!match) {
                match = generateDynamicPairing(
                    `${volume1}-${focus1}-${trait1}`,
                    `${volume2}-${focus2}-${trait2}`,
                    forwardPairing
                );
            }

            document.getElementById("pairing").textContent = forwardPairing;
            document.getElementById("description").textContent = match.description || 'No description available.';
            document.getElementById("cautions").textContent = match.cautions || 'No cautions available.';
            document.getElementById("advice").textContent = match.advice || 'No advice available.';
        }

        const dropdowns = ["volume1", "focus1", "trait1", "volume2", "focus2", "trait2", "mode"];
        dropdowns.forEach(id => {
            const element = document.getElementById(id);
            if (element) {
                element.addEventListener("change", () => {
                    if (id === "mode") {
                        currentMode = element.value;
                        loadPairings(currentMode);
                    } else {
                        updateOutput();
                    }
                });
            }
        });

        loadPairings(currentMode);
    </script>
</body>
</html>
